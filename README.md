##  评测指标体系

###  技术栈

- **Java 17**
- **Spring Boot 3.5.6**
- **LangChain4j 1.0.0-beta3**：文档处理和向量化
- **AllMiniLmL6V2**：轻量级embedding模型
- **Qwen (DashScope)**：大语言模型用于生成和评估
  
### 1. 检索性能指标（Retrieval Metrics）

#### Recall@K
- **定义**：在前K个检索结果中，有多少比例的相关文档被成功找到
- **计算公式**：`Recall@K = 检索到的相关文档数（去重后） / 总相关文档数`
- **评估K值**：K ∈ {1, 3, 5, 10}
- **意义**：衡量检索系统的覆盖能力，值越高表示能找到更多相关文档

#### Precision@K
- **定义**：在前K个检索结果中，检索到的文档有多少比例是相关的
- **计算公式**：`Precision@K = 检索到的相关文档数（去重后） / 检索出的唯一文档数`
- **评估K值**：K ∈ {1, 3, 5, 10}
- **意义**：衡量检索系统的准确度，值越高表示检索结果越精准

#### MRR (Mean Reciprocal Rank)
- **定义**：平均倒数排名
- **计算公式**：`MRR = (1/N) * Σ(1 / rank_i)`，其中rank_i是第i个查询中第一个相关文档的排名
- **计算方式**：
  1. 对检索结果按文档ID去重（文档级别评估）
  2. 找到第一个相关文档在去重后的排名
  3. 计算Reciprocal Rank = 1 / rank
  4. 对所有查询取平均值
- **意义**：衡量相关文档在检索结果中的排名靠前程度，值越高表示相关文档排名越靠前

#### Latency（检索延迟）
- **定义**：检索操作的平均耗时
- **单位**：毫秒（ms）
- **计算方式**：对每个查询的检索时间取平均值
- **意义**：衡量检索系统的响应速度

#### NDCG (Normalized Discounted Cumulative Gain)
- **状态**：当前实现中预留接口，值为0
- **说明**：需要更复杂的排序质量评估实现

### 2. 生成质量指标（Generation Metrics）

#### Faithfulness（忠实度）
- **定义**：生成的回答是否忠实于提供的上下文
- **取值范围**：[0, 1]，越高表示越忠实
- **评估方法**：三级回退策略

**方法1：LLM语义评估（优先方法）**
- 通过prompt让LLM判断答案是否可以从上下文推断
- 支持语义理解、同义词识别、逻辑推断
- 优点：最准确，能理解语义相似性
- 缺点：依赖LLM调用，成本较高

**方法2：Embedding相似度评估（备用方法）**
- 算法流程：
  1. 将答案分割成句子
  2. 计算每个答案句子与上下文的embedding余弦相似度
  3. 对相似度取平均
  4. 使用sigmoid函数平滑映射到0-1范围
- 优点：平衡准确度和成本
- 缺点：语义理解能力有限

**方法3：单词重叠方法（最后备选）**
- 计算答案与上下文的单词重叠比例
- 去除停用词后计算共同单词比例
- 优点：快速简单
- 缺点：准确度最低

#### Hallucination Rate（幻觉率）
- **定义**：生成的回答中包含不在上下文中信息的比例
- **计算公式**：`Hallucination Rate = 1 - Faithfulness`
- **取值范围**：[0, 1]，越高表示幻觉越多
- **意义**：衡量生成内容是否包含虚假或无关信息

#### Context Utilization（上下文利用率）
- **定义**：衡量生成回答中有效利用上下文信息的程度
- **计算公式**：
  1. 将答案和上下文都按句子分割
  2. 统计答案中有多少句子与上下文中的句子相关（通过contains判断）
  3. `利用率 = 相关句子数 / 总答案句子数`
- **取值范围**：[0, 1]，越高表示利用越好
- **意义**：评估模型是否充分使用了检索到的上下文信息

### 3. 系统性能指标（System Metrics）

#### Build Speed（构建速度）
- **定义**：构建向量存储的耗时
- **单位**：秒（s）
- **意义**：衡量chunking策略的构建效率

#### Index Size（索引大小）
- **定义**：向量索引中包含的chunk数量
- **单位**：个
- **意义**：衡量索引存储的资源消耗
